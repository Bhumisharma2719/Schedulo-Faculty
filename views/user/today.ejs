<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Timetable Viewer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f7f7f7;
    color: #222;
  }

  .scroll-container {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }

  .scroll-container::-webkit-scrollbar {
    display: none; /* Chrome/Safari */
  }

  .scroll-indicator {
    position: absolute;
    left: 0.45rem; /* Aligned center on line */
    width: 20px; /* Slightly bigger */
    height: 20px;
    background-color: #0F044C; /* Dark blue */
    border-radius: 50%;
    z-index: 20;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    transition: top 0.2s ease;
  }

  /* üîî Floating Notification Ball */
  .notification-ball {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    z-index: 40;
    transition: all 0.3s ease;
    animation: float 3s ease-in-out infinite;
  }
  
  .notification-ball:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
  }
  
  .notification-ball span {
    font-size: 28px;
  }
  
  .notification-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: #FFD700;
    color: #333;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }
  
  /* üìã Notification Modal */
  .notification-modal {
    display: none;
    position: fixed;
    z-index: 50;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
  }
  
  .notification-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .notification-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  
  .notification-item {
    background: #F0F4FF;
    padding: 15px;
    margin: 10px 0;
    border-left: 4px solid #0F044C;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .notification-item:hover {
    background: #E8EFFF;
    transform: translateX(5px);
  }

  /* üìÖ Scheduled Classes Section */
  .scheduled-classes-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .scheduled-class-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    transition: all 0.3s ease;
  }
  
  .scheduled-class-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }

  .badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.3);
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    margin: 2px 2px;
  }
</style>

</head>

<!-- ‚úÖ Add full-height flex layout -->
<body class="min-h-screen flex flex-col">

  <!-- ‚úÖ Content Wrapper with flex-grow -->
  <div class="flex-grow">
    <!-- Header -->
<header class="bg-[#0F044C] shadow-md py-4 px-6 w-full">
  <div class="flex items-center justify-between max-w-7xl mx-auto">
    <!-- Left: Logo or Schedulo -->
    <div class="flex items-center space-x-3">
      <img src="/images/Logo.png" alt="Logo" class="h-10 md:h-14 filter brightness-0 invert" />
    </div>

    <!-- Desktop Nav Links -->
    <div class="hidden md:flex items-center space-x-4">
      <a href="/user/timetable" class="bg-[#0F044C] text-white px-4 py-2 rounded hover:bg-[#787A91] transition text-sm md:text-base">Full Timetable</a>
      <a href="/user/timetable/today" class="bg-[#0F044C] text-white px-4 py-2 rounded hover:bg-[#787A91] transition text-sm md:text-base">Today‚Äôs Timetable</a>
      <a href="/about" class="bg-[#0F044C] text-white px-4 py-2 rounded hover:bg-[#787A91] transition text-sm md:text-base">About Us</a>
      <a href="/auth/logout" class="bg-[#0F044C] text-white px-4 py-2 rounded hover:bg-[#787A91] transition text-sm md:text-base">Logout</a>
    </div>

    <!-- Mobile Menu Button -->
    <div class="md:hidden relative">
      <button id="menuToggle" class="text-white focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Dropdown Menu -->
      <div id="mobileMenu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden z-50">
        <a href="/user/timetable" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Full Timetable</a>
        <a href="/user/timetable/today" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Today‚Äôs Timetable</a>
        <a href="/auth/logout" class="block px-4 py-2 text-gray-800 hover:bg-gray-100">Logout</a>
      </div>
    </div>
  </div>
</header>


    <!-- Main Content -->
    <main class="mt-10 px-6 max-w-5xl mx-auto">
      <h2 class="text-center text-2xl md:text-3xl font-bold mb-6 text-gray-800">Today‚Äôs Timetable (<%= today %>)</h2>

      <!-- Course Selector -->
      <form method="GET" action="/user/timetable/today" class="mb-6 flex flex-col md:flex-row justify-center items-center gap-4">
        <div>
          <label for="course" class="block text-sm font-medium text-gray-700 mb-1">üéì Select Course</label>
          <select name="course" id="course" class="w-64 px-3 py-2 border border-gray-300 rounded shadow-sm" onchange="this.form.submit()">
            <option value="">-- Select Course --</option>
            <% courses.forEach(course => { %>
              <option value="<%= course %>" <%= course === selectedCourse ? 'selected' : '' %>><%= course %></option>
            <% }) %>
          </select>
        </div>
      </form>

      <% if (!selectedCourse) { %>
        <p class="text-red-500 text-center">Please select a course to view today‚Äôs schedule.</p>
      <% } else if (!todaySchedule || todaySchedule.length === 0) { %>
        <p class="text-yellow-600 text-center">No lectures scheduled for <%= today %>.</p>
      <% } else { %>
        <div class="scroll-container max-h-[70vh] overflow-y-auto relative max-w-4xl mx-auto" id="scrollContainer">
  <!-- Scroll ball (over left line) -->
  <div class="scroll-indicator" id="scrollBall"></div>

  <div class="relative mt-6 pl-6 md:pl-10 pb-10">
    <!-- Vertical blue line -->
    <div class="absolute left-3 md:left-4 top-0 w-1 bg-[#0F044C] rounded" style="height: calc(100% - 40px);"></div>

    <% todaySchedule.forEach((entry) => { %>
      <!-- Schedule block (no change needed) -->
      <div class="flex flex-col md:flex-row md:items-start gap-2 md:gap-4 mb-6 relative group">

  <!-- Blue dot placed on vertical line -->
    <div class="absolute left-[-1.75rem] top-[1.15rem] w-3 h-3 bg-[#0F044C] rounded-full z-20"></div>

  <!-- Time -->
  <div class="w-full md:w-24 shrink-0 text-left md:text-right text-sm font-semibold text-[#0F044C] pt-1">
    <%= entry.time %>
  </div>

  <!-- Schedule card -->
  <div class="bg-white text-gray-800 rounded-2xl shadow-lg p-4 w-full hover:bg-gray-100 transition border border-gray-100">
    <div class="flex justify-between items-center mb-2">
      <div class="text-lg font-semibold tracking-wide"><%= entry.subject %></div>
      <% if (entry.type === 'Lab') { %>
        <span class="text-sm bg-green-200 text-green-800 px-2 py-1 rounded-full">Lab</span>
      <% } else if (entry.type === 'Free') { %>
        <span class="text-sm bg-gray-300 text-gray-700 px-2 py-1 rounded-full">Free</span>
      <% } else { %>
        <span class="text-sm bg-blue-200 text-blue-800 px-2 py-1 rounded-full">Lecture</span>
      <% } %>
    </div>
    <% if (entry.type !== 'Free') { %>
      <div class="text-sm mb-1">üë®‚Äçüè´ <%= entry.teacher %></div>
      <div class="text-sm">üìç Room: <%= entry.room %></div>
    <% } else { %>
      <div class="text-sm italic text-gray-500">No session scheduled</div>
    <% } %>
  </div>

</div>

    <% }) %>
  </div>
</div>

      <% } %>
    </main>
  </div> <!-- ‚úÖ End of flex-grow wrapper -->

  <!-- üìÖ SCHEDULED CLASSES FOR TODAY -->
  <% if (temporarySchedules && temporarySchedules.length > 0) { %>
    <div class="scheduled-classes-section">
      <h3 class="text-2xl font-bold mb-4 text-[#0F044C]">
        ‚úÖ Classes Scheduled For Today
      </h3>
      
      <% temporarySchedules.forEach(schedule => { %>
        <div class="scheduled-class-card">
          <div class="mb-2">
            <h4 class="font-bold text-lg"><%= schedule.course %> - <%= schedule.subject || 'N/A' %></h4>
          </div>
          <p>
            <strong>Teacher:</strong> <%= schedule.teacher %>
            <% if (schedule.teacherEmail) { %>
              (<%= schedule.teacherEmail %>)
            <% } %>
          </p>
          <p>
            <strong>Time Slot:</strong> 
            <span class="badge"><%= schedule.to.day %> - <%= schedule.toTime %></span>
          </p>
          <p>
            <strong>Room:</strong> 
            <span class="badge"><%= schedule.room %>, <%= schedule.building %></span>
          </p>
          <p class="mt-2 text-sm opacity-90">
            <strong>Originally scheduled for:</strong> <%= schedule.from.day %> - <%= schedule.fromTime %>
          </p>
        </div>
      <% }); %>
    </div>
  <% } %>

  <!-- üîî FLOATING NOTIFICATION BALL -->
  <% if (notifications && notifications.length > 0) { %>
    <div class="notification-ball" onclick="openNotifications()">
      <span>üì¨</span>
      <div class="notification-badge"><%= notifications.length %></div>
    </div>
  <% } %>

  <!-- üìã NOTIFICATION MODAL -->
  <div id="notificationModal" class="notification-modal">
    <div class="notification-content">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-[#0F044C]">üì¨ Schedule Notifications</h3>
        <button onclick="closeNotifications()" class="text-2xl cursor-pointer">‚úï</button>
      </div>

      <!-- Filter by Course -->
      <div class="mb-6">
        <label class="block text-sm font-medium mb-2">Filter by Course:</label>
        <select id="courseFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md" onchange="filterNotifications()">
          <option value="">All Courses</option>
          <% 
            const uniqueCourses = [...new Set(notifications.map(n => n.course))];
            uniqueCourses.forEach(course => { 
          %>
            <option value="<%= course %>"><%= course %></option>
          <% }); %>
        </select>
      </div>

      <!-- Notifications List -->
      <div id="notificationsList">
        <% notifications.forEach((notif, idx) => { %>
          <div class="notification-item" data-course="<%= notif.course %>">
            <div class="font-bold text-[#0F044C] mb-2">
              üìå <%= notif.course %> - <%= notif.subject %>
            </div>
            <div class="text-sm space-y-1">
              <p>
                <strong>Teacher:</strong> <%= notif.teacher %>
                <% if (notif.teacherEmail) { %>
                  (<a href="mailto:<%= notif.teacherEmail %>" class="text-blue-600 underline"><%= notif.teacherEmail %></a>)
                <% } %>
              </p>
              <p>
                <strong>Original Slot:</strong> <%= notif.fromSlot.day %> - <%= notif.fromTime %>
              </p>
              <p>
                <strong>New Slot:</strong> <%= notif.toSlot.day %> - <%= notif.toTime %>
                <% 
                  const notifDate = new Date(notif.toSlot.date);
                  const d = String(notifDate.getDate()).padStart(2, '0');
                  const m = String(notifDate.getMonth() + 1).padStart(2, '0');
                  const y = notifDate.getFullYear();
                %>
                (Date: <%= d %>-<%= m %>-<%= y %>)
              </p>
              <p>
                <strong>Room:</strong> <%= notif.room %>, <%= notif.building %>
              </p>
              <p class="text-gray-500">
                <strong>Notified:</strong>
                <% 
                  const notifTime = new Date(notif.createdAt);
                  const time = notifTime.toLocaleString();
                %>
                <%= time %>
              </p>
            </div>
          </div>
        <% }); %>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Footer stays at bottom -->
  <footer class="bg-[#0F044C] text-white text-center py-4">
     <p>¬©2025 Schedulo</p>
  <p>
    <a href="/about" class="underline hover:text-gray-300 transition">About Us</a>
  </p>
  </footer>
<script>
document.addEventListener("DOMContentLoaded", function () {
  // Scroll Ball
  const scrollContainer = document.getElementById('scrollContainer');
  const scrollBall = document.getElementById('scrollBall');

  if (scrollContainer && scrollBall) {
    scrollContainer.addEventListener('scroll', () => {
      const scrollTop = scrollContainer.scrollTop;
      const maxScroll = scrollContainer.scrollHeight - scrollContainer.clientHeight;
      const percentage = scrollTop / maxScroll;
      const maxBallPosition = scrollContainer.scrollHeight - 50;
      const topValue = percentage * maxBallPosition;
      scrollBall.style.top = `${topValue}px`;
    });
  }

  // Mobile Menu Toggle
  const menuToggle = document.getElementById('menuToggle');
  const mobileMenu = document.getElementById('mobileMenu');

  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });
  }
});

// üîî Notification Functions
function openNotifications() {
  document.getElementById('notificationModal').classList.add('active');
}

function closeNotifications() {
  document.getElementById('notificationModal').classList.remove('active');
}

function filterNotifications() {
  const filter = document.getElementById('courseFilter').value;
  const items = document.querySelectorAll('.notification-item');
  
  items.forEach(item => {
    if (filter === '' || item.dataset.course === filter) {
      item.style.display = 'block';
    } else {
      item.style.display = 'none';
    }
  });
}

// Close modal when clicking outside
document.getElementById('notificationModal')?.addEventListener('click', function(e) {
  if (e.target === this) {
    closeNotifications();
  }
});
</script>

</body>
</html>
